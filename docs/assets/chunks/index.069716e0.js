var T=Object.defineProperty;var y=(l,e,i)=>e in l?T(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i;var h=(l,e,i)=>(y(l,typeof e!="symbol"?e+"":e,i),i);import"./index.a3155b6e.js";import{B as g}from"./wz-base.07e7f891.js";const D=`*{font-size:14px}.open{animation:open .1s forwards}@keyframes open{0%{height:0px;left:12px;opacity:.8}to{left:12px;height:20px;opacity:1}}.close{animation:close .1s forwards;transition:all 1s}@keyframes close{0%{left:12px;height:20px;opacity:.2}to{height:0px;left:12px;opacity:0}}.tree-node{font-size:14px;display:flex;width:100%;margin:6px 0}.tree-node ::-webkit-scrollbar-thumb{background-color:#222422;border-radius:20px}.tree-node ::-webkit-scrollbar{width:.1rem;height:.3rem}.node-content{display:flex;width:100%;overflow:hidden;align-items:center}.node-arrow{display:flex!important;align-items:center;justify-content:center;width:12px;height:12px;margin-left:0;cursor:pointer;transition:all .2s;user-select:none}.node-arrow.hide{transform:rotate(0)}.node-arrow.open{transform:rotate(90deg)}.node-title{line-height:20px;color:#333;cursor:pointer;padding:0 4px;border-radius:3px;overflow-x:hidden;text-overflow:ellipsis}.node-title:hover{background-color:#eee}.node-title.selected{background-color:#ddd}.node-children{transition:all .2s}.tree-indent{width:20px}.red{color:red}
`;function m(l,e){let i=e.parentNode;i.lastChild==e?i.appendChild(l):setTimeout(()=>{i.insertBefore(l,e.nextSibling)},0),i.insertBefore(l,e.nextSibling)}function k(l,e){let i=[];return l.forEach(t=>{t.children=l.filter(r=>t.key==r.parent),t.parent==e&&i.push(t)}),i}class P{constructor(e){h(this,"options");h(this,"$container");h(this,"TreeData");h(this,"TreePrefData");var t;const i={element:null,data:[],multiple:!1,toggle:()=>{},select:()=>{}};if(this.options=Object.assign({},i,e),this.$container=this.options.element,this.TreeData=this.options.data,console.log(this.options),this.TreePrefData={},this.initTree(),!this.options.multiple)for(let r in this.TreePrefData){this.TreePrefData[this.TreePrefData[r].key].selected=!1;let s=this.$container.querySelector(`[tree-id="${this.TreePrefData[r].key}"]`);(t=s==null?void 0:s.querySelector(".node-title"))==null||t.classList.remove("selected")}}flatData(e,i){let t=[];for(let r=0;r<e.length;r++)e[r].parent=i,this.TreePrefData[e[r].key]=e[r],e[r].children?t=t.concat(this.flatData(e[r].children,e[r].key)):t.push(e[r]);return t}mergeData(){let e=[];for(let t in this.TreePrefData)e.push(this.TreePrefData[t]);let i=k(JSON.parse(JSON.stringify(e)),0);this.TreeData=i}initTree(){for(let e=0;e<this.TreeData.length;e++)this.initTreeNode(this.TreeData[e],0);this.flatData(this.TreeData,"0")}initTreeNode(e,i,t){e.layer=i;let r;if(t)return r=this.CreateTreeNode(e,i,!0),m(r,t);if(r=this.CreateTreeNode(e,i),this.$container.appendChild(r),!e.children)return this.$container.appendChild(r),r;if(e.expand)for(let s=0;s<e.children.length;s++)this.initTreeNode(e.children[s],i+1)}delTreeNode(e,i,t){if(t){e.children&&this.CloseCollpse(e.key,i+1),t.classList.add("close"),t.addEventListener("animationend",()=>{t.remove()});return}}CreateTreeNode(e,i,t){const r=document.createElement("div");r.setAttribute("class","tree-node");for(let n=0;n<i;n++){let c=document.createElement("div");c.setAttribute("class","tree-indent"),r.appendChild(c)}r.setAttribute("tree-id",e.key);const s=document.createElement("div");s.setAttribute("class","node-content");const a=document.createElement("wz-icon");if(e.children){let n=e.expand?"open":"",c=e.searched?"red":"";t&&(n=`${c}`),a.setAttribute("class",`node-arrow   ${n} ${c} `),a.setAttribute("name","solid/angle-right")}else{let n=e.searched?"red":"";a.setAttribute("class",`node-arrow hide ${n} `)}a.addEventListener("click",()=>{this.TreePrefData[e.key].expand?(a.classList.remove("open"),this.CloseCollpse(e.key,e.layer)):(a.classList.add("open"),this.OpenCollpse(e.key,e.layer)),this.TreePrefData[e.key].expand=!this.TreePrefData[e.key].expand,this.mergeData(),this.options.toggle.call(null,e)});const o=document.createElement("span"),d=e.selected?"selected":"",f=e.searched?"red":"";return o.setAttribute("class",`node-title ${d} ${f}`),o.innerText=e.title,o.addEventListener("click",()=>{var c;let n=this.$container.querySelector(`[tree-id="${e.key}"]`);if(this.options.multiple)n==null||n.querySelector(".node-title").classList.toggle("selected"),this.TreePrefData[e.key].selected=!e.selected;else{for(let u in this.TreePrefData){this.TreePrefData[this.TreePrefData[u].key].selected=!1;let p=this.$container.querySelector(`[tree-id="${this.TreePrefData[u].key}"]`);(c=p==null?void 0:p.querySelector(".node-title"))==null||c.classList.remove("selected")}this.TreePrefData[e.key].selected=!0,n.querySelector(".node-title").classList.toggle("selected")}this.options.select.call(null,e,this.selectData()),this.mergeData()}),s.appendChild(a),s.appendChild(o),s.classList.add("open"),r.appendChild(s),r}OpenCollpse(e,i){let t=this.$container.querySelector(`[tree-id="${e}"]`),r=this.TreePrefData[t==null?void 0:t.getAttribute("tree-id")];if(r&&r.children)for(let s=r.children.length-1;s>=0;s--)r.children[s].expand=!1,this.initTreeNode(r.children[s],i+1,t)}CloseCollpse(e,i){let t=this.$container.querySelector(`[tree-id="${e}"]`),r=this.TreePrefData[t==null?void 0:t.getAttribute("tree-id")];if(r.children)for(let s=r.children.length-1;s>=0;s--)r.children[s].expand=!1,this.delTreeNode(r.children[s],i+1,this.$container.querySelector(`[tree-id='${r.children[s].key}']`))}asyncData(e,i){if(this.TreePrefData[e]){for(let t=0;t<i.length;t++)this.TreePrefData[i[t].key]=i[t];if(this.mergeData(),!this.TreePrefData[e].children){this.TreePrefData[e].children=[];let t=this.$container.querySelector(`[tree-id="${e}"]`),r=t==null?void 0:t.querySelector(".node-arrow");r==null||r.classList.remove("hide"),r==null||r.setAttribute("name","solid/angle-right"),setTimeout(s=>{var a,o;if(s.click(),setTimeout(()=>{s.click()},100),!this.options.multiple){for(let d in this.TreePrefData){this.TreePrefData[this.TreePrefData[d].key].selected=!1;let f=this.$container.querySelector(`[tree-id="${this.TreePrefData[d].key}"]`);console.log("dom:",f),(o=(a=f==null?void 0:f.querySelector(".node-title"))==null?void 0:a.classList)==null||o.remove("selected")}this.mergeData()}},0,r)}this.flatData(i,e),this.TreePrefData[e].children.push(...i),this.mergeData()}}selectData(){let e=[];for(let i in this.TreePrefData)this.TreePrefData[i].selected&&e.push(this.TreePrefData[i]);return e}searchDataSwitch(e,i){let t=[];return this.TreePrefData[e].parent!=i?(t.push(this.TreePrefData[e]),t=t.concat(this.searchDataSwitch(this.TreePrefData[e].parent,"0"))):t.push(this.TreePrefData[e]),t}searchData(e){let i=[];for(let t in this.TreePrefData)this.TreePrefData[this.TreePrefData[t].key],this.TreePrefData[t].key.includes(e)&&i.push(this.TreePrefData[t]);console.log(i),i.forEach(t=>{let r=this.searchDataSwitch(t.key,"0");for(let s=r.length-1;s>=1;s--)setTimeout(a=>{var d;if(this.TreePrefData[a.key].expand||!this.TreePrefData[a.key].children)return;(d=this.$container.querySelector(`[tree-id="${a.key}"]`).querySelector(".node-arrow"))==null||d.click()},0,r[s])}),setTimeout(()=>{i.forEach(t=>{var s,a;let r=this.$container.querySelector(`[tree-id="${t.key}"]`);this.TreePrefData[t.key].searched=!0,(s=r.querySelector(".node-arrow"))==null||s.classList.add("red"),(a=r.querySelector(".node-title"))==null||a.classList.add("red")}),this.mergeData()},0)}}function x(l){let e=l;return e=Function("return "+e)(),e.toggle=Function("return "+e.toggle)(),e.select=Function("return "+e.select)(),e}class $ extends g{constructor(){super();h(this,"close");h(this,"config");h(this,"ClassInstance");this.close=!1}static get observedAttributes(){return["config"]}connectedCallback(){this.render({}),this.adoptedStyle(D)}attributeChangedCallback(i,t,r){r=x(r);let s=this;switch(console.log("传入参数:",r,i),i){case"config":this.config=r,this.shadowRootInit.querySelector(".tree")&&(s.ClassInstance=new P({element:this.shadowRootInit.querySelector(".tree"),...r}));break}}render(i){let t=document.createElement("template");t.innerHTML=`
            <div class="tree">
            </div>
        `,this.shadowRootInit.appendChild(t.content)}switchActive(){}}customElements.define("wz-tree",$);customElements.whenDefined("wz-tree").then(function(){console.log("开始define",this)});
